---
title: "Project 1: Statistical Tools"
subtitle: "MS in Statistics for Data Science"
author: "Gabriela Levenfeld Sabau"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
    toc: yes
    toc_depth: 6
    keep_tex: yes
  geometry: left=3cm,right=3cm,top=2cm,bottom=2cm
  mathjax: local
  self_contained: no
  word_document:
    toc: yes
    toc_depth: '6'
bibliography: references.bib
nocite: '@*'
link-citations: yes
linkcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

\pagebreak

# Introduction

## Dataset description

Data can be found in Kaggle: <https://www.kaggle.com/datasets/blastchar/telco-customer-churn>.

It contains information from $7043$ clients distributed into $21$ different variables.

This dataset is made in order to predict *customer churn*. In the business sector, in order to make a profit, the number of customers gained and lost is really important. It not only allow us to compute the benefit that a company can have, it is also a good metric to evaluate and get insight about the strategy we are employing. This, let us to make decisions to make the next steps.

## Variables description

The information contained in this dataset can be group into different areas.

\underline{Personal information about the customer}.

- `customerID`: Unique identifier for the client.

- `gender`: Female or Male.

- `SeniorCitizen`: Binary variable that indicates if >65 (yes) or not (no).

- `Partner`: Whether the customer has a partner or not (Yes, No).

- `Dependents`: Variables which storage if the client lives with more people (children, parents, grandparents,...).

\underline{Services subscribed}.

- `tenure`: Indicates the total amount of months that the customer has been with the company by the end of the 3Q (third quarter).

- `PhoneService`: Yes if client is subscribed to home phone service with the company and No if not.

- `MultipleLines`: Yes if the client has more than 1 telephone lines with the company and No if just one.

- `InternetService`:  Indicates if the customer subscribes to Internet service with the company: No, DSL, Fiber Optic, Cable. 4 options are available.

- `OnlineSecurity`: Yes if the client has online security service (extra service) provided by the company and No if not.

- `OnlineBackup`:  Indicates if the customer subscribes to an additional online backup service provided by the company: Yes, No.

- `DeviceProtection`: Indicates if the customer subscribes to an additional device protection plan for their Internet equipment provided by the company: Yes, No.

- `TechSupport`: Indicates if the customer subscribes to an additional technical support plan from the company with reduced wait times: Yes, No.

- `StreamingTV`: Indicates if the customer uses their Internet service to stream television programing from a third party provider: Yes, No. The company does not charge an additional fee for this service.

- `StreamingMovies`: Indicates if the customer uses their Internet service to stream movies from a third party provider: Yes, No. The company does not charge an additional fee for this service

\underline{Account information}

- `Contract`: Indicates the customer’s current contract type: Month-to-Month, One Year, Two Year.

- `PaperlessBilling`: Indicates if the customer has chosen paperless billing: Yes, No.

- `PaymentMethod`: Indicates how the customer pays their bill: Bank Withdrawal, Credit Card, Mailed Check.

- `MonthlyCharges`:  Indicates the customer’s current total monthly charge for all their services from the company.

- `TotalCharges`: Indicates the customer’s total charges, calculated to the end of the 3Q (third quarter).

\underline{Target variable}

- `Churn`: Yes = the customer left the company this quarter. No = the customer remained with the company.


## Goal

Prediction over the `Churn` variable. Binary clasiffication problem, where we want to predict is a client is going to continue with the services provided by the company. Or if he is going to leave.

\pagebreak
# Data preprocessing

In this first section, we must prepare the dataset in order to use it for the computational model. This means handling missing data, deleting unnecessary information, encoding categorical variables and splitting the data, among other.


## 1. Load data.

```{r load_libraries, message=FALSE, warning=FALSE}
# Libraries needed for the project in order to work properly
library(skimr)
library(caret) # For split the dataset
library(tidyverse) # For glimpse
```

```{r load_data}
# Load the dataset for this project
data <- read.csv("Telco-Customer-Churn.csv", header = TRUE, sep = ",")
```


```{r small_EDA}
# Small Exploratory Data Analysis
skim(data)
# Presents results for every column; the statistics it provides depend on the class of the variable

glimpse(data)

# For visualize the first 2 rows
head(data, 2)
```

## 2. Deleting unnecessary information.

Thanks to the above function, we realized we can remove the ID column (`customerID`), because it will not be useful for making predictions. On the other hand `PaperlessBilling` is also removed, I think it does not have too much sense.

```{r rmv_columns}
# Remove ID column 
data <- data %>% select(-c(customerID,PaperlessBilling))
```

## 3. Encoding qualitative variables.

Encoding qualitative variables as well as rearrange them.
These variables have been organized to facilitate working with them. The multi-state categorical variables ($3$: `MultipleLines`, `InternetService`, `Contract`,  `PaymentMethod`) precede the binary variables ($13$: `gender`, `SeniorCitizen`, `Partner`, `Dependents`, `PhoneService`, `OnlineSecurity`, `OnlineBackup`, `DeviceProtection`, `TechSupport`, `StreamingTV`, `StreamingMovies`, `Churn`), followed by the quantitative variables ($3$: `tenure`, `MonthlyCharges`, `TotalCharges`). Last variable is the target.

```{r}
# Convert binary variables to numeric (Yes/No to 1/0)
binary_vars <- c("Partner", "Dependents", "PhoneService", "PaperlessBilling", "Churn")
data[binary_vars] <- lapply(data[binary_vars], function(x) ifelse(x == "Yes", 1, 0))
```



## Handling missing data    .

```{r}
# Counting NA
colSums(is.na(data)) # 11 NA's in TotalCharges

colSums(is.na(data))/nrow(data)
percentage_na <- colSums(is.na(data))/nrow(data)*100 # In %
sort(percentage_na, decreasing = TRUE)
```

```{r}
table(data$Churn)
```

```{r}
# Split into training and testing set
set.seed(1234) # For reproducibility
index <- createDataPartition(data$Churn, p=0.8, list=FALSE)

X_train <- data[index,]
X_test <- data[-index,]
y_train <- data[index,]$Churn
y_test <- data[-index,]$Churn

# In order to check proportion are still the same
table(data$Churn)/length(data$Churn)
table(X_train$Churn)/length(X_train$Churn)
table(X_test$Churn)/length(X_test$Churn)
```


## Exploratory Data Analysis (EDA)

*Some ideas*
REVIEW: some ideas to check for
Working with real data can be challenging-
The data can be:
- Be stored in different formats.
- Being incomplete: missing values.
- Noise (data contaminated): may have errors.
- Inconsistend: not corresponding to the attribute domain or contradictory

# Statistical tools
## LDA
## QDA
## Más modelos


# Conclusion

# References

```{r}
# Returns the names of all packages loaded in the current R session
knitr::write_bib(.packages(), "references.bib")
```

<div id="refs"></div>
