---
title: 'Project 2: Machine-learning tools'
author: "Gabriela Levenfeld Sabau"
date: "`r Sys.Date()`"
output:
  html_document:
    number_sections: yes   
    toc: TRUE              
    toc_float: TRUE
  geometry: left=3cm,right=3cm,top=2cm,bottom=2cm
  mathjax: local
  self_contained: false
subtitle: MS in Statistics for Data Science
#bibliography: references.bib
#nocite: '@*'
link-citations: true
linkcolor: blue
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Dataset description
## Variables description
**Quantitative**
bp		-	Blood pressure
bgr		-	Blood glucose random
bu		-	Blood urea
sc		-	Serum creatinine
sod		-	Sodium
pot		-	Potassium
hemo	-	Hemoglobin
pcv		- Packed cell volume
wbcc		-	White blood cell count
rbcc		-	Red blood cell count

**Qualitative, Categorical**
sg		-	Specific gravity
al		- Albumin
su		-	Sugar

**Qualitative, Binary**
rbc		-	Red blood cells
pc		-	Pus cell
pcc		-	Pus cell clumps
ba		-	Bacteria
htn		-	Hypertension
dm		-	Diabetes mellitus
cad		-	Coronary artery disease
appet	-	Appetite
pe		-	Pedal edema
ane		-	Anemia

**Target**
class	-	class

\pagebreak
# Data preprocessing

This section focuses on preparing the dataset for exploratory data analysis (EDA) and applying the computational models. This include loading the necessary material, handling missing values, encoding categorical variables, and splitting the dataset into training and testing subsets, among other tasks.

## Load material.

**Load libraries**. Several libraries are need for the project in order to work properly.

```{r load_libraries, message=FALSE, warning=FALSE}
library(skimr) # Summary statistics
library(tidyverse) # Include ggplot2, dplyr, among others
```

**Load dataset**. The dataset was store as an .arff file, in order to open the dataset I make some arrangement in python enviroment. I attatched the code used in order to generate a .csv so I can work with during the rest of the project.

```{python open_file_python, eval=FALSE}
# Require libraries ------------------------------------------------------------
from scipy import io
import pandas as pd

# Load .arff file: extract the df and metadata ---------------------------------
dataframe, meta = io.arff.loadarff('data/chronic_kidney_disease_full.arff')
# Transform into pd df for handling
dataframe = pd.DataFrame(dataframe) # Some variables are into b'value' (bad format)

# Fixing bad format ------------------------------------------------------------
def bytes_to_int(byte_value):
    try:
        return byte_value.decode('utf-8') # Decode bytes to a string
    except AttributeError:
        return byte_value # When it is already a string
      
# Apply the conversion function to the specified columns in df
for column in dataframe.columns:
    dataframe[column] = dataframe[column].apply(bytes_to_int)

# Save the df to .csv file -----------------------------------------------------
dataframe.to_csv("data/chronic_kidney_disease_full.csv", index=False)
```

```{r load_dataset, eval=FALSE}
# Load new .csv dataset
data <- read.csv("data/chronic_kidney_disease_full.csv", header = TRUE, sep = ",")
```

**First look at the dataset**. Brief overview of the dataset for further preprocessing steps.

```{r small_EDA1, eval=FALSE, include=FALSE}
# Small Exploratory Data Analysis
skim(data)
# Presents results for every column; the statistics it provides depend on the class of the variable

# For visualizing the first 2 rows
head(data, 2)
```

```{r small_EDA2}
glimpse(data)
```

## Delete unnecessary information.

Some variables are removed due to its usefulness contribution on the model for making predictions.

```{r rmv_columns}
# Remove unnecessary variables

```

## Handling missing data.

```{r counting_NAs, eval=FALSE, include=FALSE, results='hide'}
# Counting NA's ----------------------------------------------------------------
missing_values <- colSums(is.na(data))
sort(missing_values, decreasing = TRUE)

percentage_na <- missing_values/nrow(data)*100 # NA's in %
sort(percentage_na, decreasing = TRUE)

# Get the index of the rows where TotalCharges=NA
index_age_na <- which(is.na(data$age))
data[index_age_na,]
print(index_age_na)
```
